{"ast":null,"code":"export default {\n  props: ['kbId'],\n  data() {\n    return {\n      input: '',\n      messages: [],\n      eventSource: null\n    };\n  },\n  methods: {\n    sendMessage() {\n      if (!this.input.trim()) return;\n      const question = this.input;\n      this.input = '';\n\n      // 添加用户消息\n      this.messages.push({\n        role: 'user',\n        content: question\n      });\n\n      // 创建新消息占位符\n      this.messages.push({\n        role: 'assistant',\n        content: ''\n      });\n      const messageIndex = this.messages.length - 1;\n\n      // 连接SSE\n      if (this.eventSource) this.eventSource.close();\n      this.eventSource = new EventSource(`${this.$axios.defaults.baseURL}/ask?kb_id=${this.kbId}&question=${encodeURIComponent(question)}`, {\n        withCredentials: true\n      });\n      this.eventSource.onmessage = event => {\n        this.messages[messageIndex].content += event.data;\n      };\n      this.eventSource.onerror = () => {\n        this.eventSource.close();\n      };\n    }\n  },\n  beforeDestroy() {\n    if (this.eventSource) this.eventSource.close();\n  }\n};","map":{"version":3,"names":["props","data","input","messages","eventSource","methods","sendMessage","trim","question","push","role","content","messageIndex","length","close","EventSource","$axios","defaults","baseURL","kbId","encodeURIComponent","withCredentials","onmessage","event","onerror","beforeDestroy"],"sources":["src/components/ChatBox.vue"],"sourcesContent":["<template>\r\n  <div class=\"chat-box\">\r\n    <div class=\"messages\">\r\n      <div v-for=\"(msg, index) in messages\" :key=\"index\" :class=\"['message', msg.role]\">\r\n        {{ msg.content }}\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"input-area\">\r\n      <el-input v-model=\"input\" placeholder=\"输入问题...\" @keyup.enter=\"sendMessage\"></el-input>\r\n      <el-button type=\"primary\" @click=\"sendMessage\">发送</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: ['kbId'],\r\n  data() {\r\n    return {\r\n      input: '',\r\n      messages: [],\r\n      eventSource: null\r\n    }\r\n  },\r\n  methods: {\r\n    sendMessage() {\r\n      if (!this.input.trim()) return\r\n      \r\n      const question = this.input\r\n      this.input = ''\r\n      \r\n      // 添加用户消息\r\n      this.messages.push({ role: 'user', content: question })\r\n      \r\n      // 创建新消息占位符\r\n      this.messages.push({ role: 'assistant', content: '' })\r\n      const messageIndex = this.messages.length - 1\r\n      \r\n      // 连接SSE\r\n      if (this.eventSource) this.eventSource.close()\r\n      \r\n      this.eventSource = new EventSource(\r\n        `${this.$axios.defaults.baseURL}/ask?kb_id=${this.kbId}&question=${encodeURIComponent(question)}`,\r\n        { withCredentials: true }\r\n      )\r\n      \r\n      this.eventSource.onmessage = (event) => {\r\n        this.messages[messageIndex].content += event.data\r\n      }\r\n      \r\n      this.eventSource.onerror = () => {\r\n        this.eventSource.close()\r\n      }\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    if (this.eventSource) this.eventSource.close()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.chat-box {\r\n  border: 1px solid #eee;\r\n  border-radius: 5px;\r\n  padding: 15px;\r\n  height: 500px;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.messages {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.message {\r\n  padding: 10px;\r\n  margin-bottom: 10px;\r\n  border-radius: 5px;\r\n}\r\n\r\n.message.user {\r\n  background-color: #f0f7ff;\r\n  text-align: right;\r\n}\r\n\r\n.message.assistant {\r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.input-area {\r\n  display: flex;\r\n}\r\n\r\n.input-area .el-input {\r\n  flex: 1;\r\n  margin-right: 10px;\r\n}\r\n</style>"],"mappings":"AAgBA;EACAA,KAAA;EACAC,KAAA;IACA;MACAC,KAAA;MACAC,QAAA;MACAC,WAAA;IACA;EACA;EACAC,OAAA;IACAC,YAAA;MACA,UAAAJ,KAAA,CAAAK,IAAA;MAEA,MAAAC,QAAA,QAAAN,KAAA;MACA,KAAAA,KAAA;;MAEA;MACA,KAAAC,QAAA,CAAAM,IAAA;QAAAC,IAAA;QAAAC,OAAA,EAAAH;MAAA;;MAEA;MACA,KAAAL,QAAA,CAAAM,IAAA;QAAAC,IAAA;QAAAC,OAAA;MAAA;MACA,MAAAC,YAAA,QAAAT,QAAA,CAAAU,MAAA;;MAEA;MACA,SAAAT,WAAA,OAAAA,WAAA,CAAAU,KAAA;MAEA,KAAAV,WAAA,OAAAW,WAAA,CACA,QAAAC,MAAA,CAAAC,QAAA,CAAAC,OAAA,mBAAAC,IAAA,aAAAC,kBAAA,CAAAZ,QAAA,KACA;QAAAa,eAAA;MAAA,CACA;MAEA,KAAAjB,WAAA,CAAAkB,SAAA,GAAAC,KAAA;QACA,KAAApB,QAAA,CAAAS,YAAA,EAAAD,OAAA,IAAAY,KAAA,CAAAtB,IAAA;MACA;MAEA,KAAAG,WAAA,CAAAoB,OAAA;QACA,KAAApB,WAAA,CAAAU,KAAA;MACA;IACA;EACA;EACAW,cAAA;IACA,SAAArB,WAAA,OAAAA,WAAA,CAAAU,KAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}